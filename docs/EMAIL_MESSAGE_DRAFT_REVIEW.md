# Email/Message Draft 검토 사항

**작성일**: 2025-01-XX  
**대상**: `src/components/messages/MessageComposer.tsx`, `src/types/messageTemplates.ts`  
**목적**: 이메일/메시지 템플릿 및 드래프트 기능 검토

---

## 📋 검토 항목

### 1. 현재 구현 상태

#### 1.1 MessageComposer 컴포넌트

- [x] **템플릿 선택**: 드롭다운에서 템플릿 선택
- [x] **채널 선택**: Email/SMS 선택
- [x] **변수 자동 채우기**: 클라이언트, 악기 정보 자동 입력
- [x] **미리보기**: 렌더링된 메시지 미리보기
- [x] **복사 기능**: 클립보드에 복사
- [x] **이메일/SMS 앱 열기**: mailto/sms 링크 생성
- [ ] **드래프트 저장**: ❌ 미구현
- [ ] **드래프트 불러오기**: ❌ 미구현
- [ ] **드래프트 편집**: ❌ 미구현

#### 1.2 Message Templates

- [x] **템플릿 정의**: 6가지 템플릿 (Thanks, Quote, Appointment, Repair Complete, Reminder, Invoice)
- [x] **채널별 템플릿**: Email/SMS 각각 정의
- [x] **변수 시스템**: `{client_name}`, `{instrument}` 등
- [x] **변수 검증**: 누락된 변수 표시
- [ ] **템플릿 편집**: ❌ 코드 수정 필요 (UI 없음)
- [ ] **커스텀 템플릿**: ❌ 사용자 정의 템플릿 불가

---

### 2. 템플릿 디자인 검토

#### 2.1 Thanks (감사)

- [ ] **이메일 제목**: "Thank you from {store_name}" 적절한지
- [ ] **이메일 본문**: 톤, 길이, 구조 적절한지
- [ ] **SMS 본문**: 160자 이내, 핵심 정보 포함 여부
- [ ] **변수**: client_name, instrument, store_name, store_phone

#### 2.2 Quote (견적)

- [ ] **이메일 제목**: "[{store_name}] Quote for {instrument}" 적절한지
- [ ] **이메일 본문**: 금액, 날짜, 링크 포함 여부
- [ ] **SMS 본문**: 핵심 정보만 포함, URL 단축 필요 여부
- [ ] **변수**: client_name, instrument, amount, due_date, quote_url, store_name, store_phone

#### 2.3 Appointment Confirmation (예약 확인)

- [ ] **이메일 제목**: "[{store_name}] Appointment confirmed — {due_date}" 적절한지
- [ ] **이메일 본문**: 날짜, 시간, 장소, 악기 정보 포함 여부
- [ ] **SMS 본문**: 확인 메시지, 날짜/시간 포함 여부
- [ ] **변수**: client_name, instrument, due_date, store_address, store_name, store_phone

#### 2.4 Repair Complete (수리 완료)

- [ ] **이메일 제목**: "[{store_name}] Your {instrument} is ready for pickup" 적절한지
- [ ] **이메일 본문**: 픽업 시간, 금액, 연락처 포함 여부
- [ ] **SMS 본문**: 완료 알림, 픽업 시간, 금액 포함 여부
- [ ] **변수**: client_name, instrument, pickup_window, amount, store_name, store_phone, store_address

#### 2.5 Reminder (리마인드)

- [ ] **이메일 제목**: "[{store_name}] Reminder — {instrument} on {due_date}" 적절한지
- [ ] **이메일 본문**: 리마인드 메시지, 날짜/시간 포함 여부
- [ ] **SMS 본문**: 간단한 리마인드 메시지
- [ ] **변수**: client_name, instrument, due_date, store_name, store_phone

#### 2.6 Invoice (인보이스)

- [ ] **이메일 제목**: "[{store_name}] Invoice — {instrument} ({amount})" 적절한지
- [ ] **이메일 본문**: 금액, 링크, 연락처 포함 여부
- [ ] **SMS 본문**: 금액, 링크 포함 여부
- [ ] **변수**: client_name, instrument, amount, invoice_url, store_name, store_phone

---

### 3. 템플릿 품질 검토

#### 3.1 톤 및 스타일

- [ ] **일관성**: 모든 템플릿의 톤이 일관적인지
- [ ] **전문성**: 비즈니스에 적합한 톤인지
- [ ] **친근함**: 너무 딱딱하지 않은지
- [ ] **명확성**: 메시지가 명확하고 이해하기 쉬운지

#### 3.2 길이 및 구조

- [ ] **이메일 길이**: 적절한 길이 (너무 짧거나 길지 않은지)
- [ ] **SMS 길이**: 160자 이내 (또는 SMS 앱 제한 고려)
- [ ] **구조**: 인사말, 본문, 마무리 구조 적절한지
- [ ] **줄바꿈**: 가독성을 위한 줄바꿈 적절한지

#### 3.3 변수 사용

- [ ] **필수 변수**: 모든 필수 변수가 포함되어 있는지
- [ ] **선택 변수**: 선택 변수가 적절히 사용되는지
- [ ] **변수 누락 처리**: 변수가 없을 때 적절한 기본값 사용 여부
- [ ] **변수 형식**: 날짜, 금액 형식이 일관적인지

---

### 4. 기능적 검토

#### 4.1 변수 렌더링

- [ ] **자동 채우기**: 클라이언트/악기 정보 자동 입력
- [ ] **날짜 형식**: `MMM d, yyyy h:mm a` 형식 적절한지
- [ ] **금액 형식**: `$XX.XX` 형식 적절한지
- [ ] **누락 변수 표시**: 누락된 변수 명확히 표시

#### 4.2 미리보기

- [ ] **실시간 미리보기**: 변수 변경 시 즉시 반영
- [ ] **제목 미리보기**: 이메일 제목 미리보기
- [ ] **본문 미리보기**: 본문 미리보기 (줄바꿈 유지)
- [ ] **에러 표시**: 누락 변수 경고 표시

#### 4.3 액션 기능

- [ ] **복사 기능**: 클립보드 복사 정상 작동
- [ ] **이메일 앱 열기**: mailto 링크 생성 정확한지
- [ ] **SMS 앱 열기**: sms 링크 생성 정확한지
- [ ] **에러 처리**: 클라이언트 이메일/전화번호 없을 때 처리

---

### 5. 드래프트 기능 (미구현)

#### 5.1 드래프트 저장

- [ ] **저장 기능**: 현재 작성 중인 메시지 저장
- [ ] **저장 위치**: 로컬 스토리지 또는 서버
- [ ] **저장 형식**: 템플릿 키, 채널, 변수, 커스텀 텍스트
- [ ] **자동 저장**: 일정 시간마다 자동 저장 (선택)

#### 5.2 드래프트 불러오기

- [ ] **드래프트 목록**: 저장된 드래프트 목록 표시
- [ ] **드래프트 선택**: 목록에서 선택하여 불러오기
- [ ] **드래프트 편집**: 불러온 드래프트 수정 가능
- [ ] **드래프트 삭제**: 불필요한 드래프트 삭제

#### 5.3 드래프트 관리

- [ ] **드래프트 메타데이터**: 저장일, 클라이언트, 악기 정보
- [ ] **드래프트 검색**: 클라이언트/악기로 검색
- [ ] **드래프트 정렬**: 날짜순, 클라이언트순 정렬
- [ ] **드래프트 만료**: 오래된 드래프트 자동 삭제 (선택)

---

### 6. 데이터베이스 설계 (필요 시)

#### 6.1 드래프트 테이블

```sql
CREATE TABLE message_drafts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  client_id UUID REFERENCES clients(id),
  instrument_id UUID REFERENCES instruments(id),
  template_key VARCHAR(50),
  channel VARCHAR(10), -- 'email' | 'sms'
  subject TEXT,
  body TEXT,
  variables JSONB,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

- [ ] **테이블 생성**: 드래프트 저장용 테이블 필요 여부
- [ ] **인덱스**: user_id, client_id, created_at 인덱스
- [ ] **RLS 정책**: 사용자별 접근 제어

#### 6.2 API 엔드포인트

- [ ] **POST /api/message-drafts**: 드래프트 저장
- [ ] **GET /api/message-drafts**: 드래프트 목록 조회
- [ ] **GET /api/message-drafts/:id**: 드래프트 상세 조회
- [ ] **PATCH /api/message-drafts/:id**: 드래프트 수정
- [ ] **DELETE /api/message-drafts/:id**: 드래프트 삭제

---

### 7. 사용자 경험 개선

#### 7.1 템플릿 편집 UI

- [ ] **템플릿 편집 모달**: 템플릿 내용 편집 가능
- [ ] **변수 추가/제거**: 템플릿에 변수 추가/제거
- [ ] **템플릿 미리보기**: 편집 중 미리보기
- [ ] **템플릿 저장**: 수정된 템플릿 저장

#### 7.2 커스텀 템플릿

- [ ] **새 템플릿 생성**: 사용자 정의 템플릿 생성
- [ ] **템플릿 공유**: 팀 내 템플릿 공유 (선택)
- [ ] **템플릿 카테고리**: 템플릿 분류 (감사, 견적 등)

#### 7.3 메시지 편집

- [ ] **직접 편집**: 미리보기에서 직접 텍스트 편집
- [ ] **변수 수동 입력**: 자동 채워지지 않은 변수 수동 입력
- [ ] **서식**: 볼드, 이탤릭 등 서식 추가 (선택)

---

### 8. 통합 검토

#### 8.1 Contact Log 연동

- [ ] **자동 기록**: 메시지 전송 시 Contact Log 자동 생성
- [ ] **템플릿 기록**: 사용한 템플릿 정보 저장
- [ ] **드래프트 연동**: 드래프트에서 전송 시 기록

#### 8.2 Calendar 연동

- [ ] **예약 확인**: Calendar의 예약과 연동
- [ ] **리마인드**: Calendar의 작업과 연동
- [ ] **자동 변수**: Calendar 정보 자동 입력

#### 8.3 Sales 연동

- [ ] **견적**: Sales의 견적과 연동
- [ ] **인보이스**: Sales의 인보이스와 연동
- [ ] **자동 변수**: Sales 정보 자동 입력

---

### 9. 프로덕션 준비

#### 9.1 환경 변수

- [ ] **`NEXT_PUBLIC_STORE_NAME`**: 매장 이름
- [ ] **`NEXT_PUBLIC_STORE_PHONE`**: 매장 전화번호
- [ ] **`NEXT_PUBLIC_STORE_ADDRESS`**: 매장 주소
- [ ] **모든 환경 변수**: 프로덕션 환경에 설정

#### 9.2 에러 처리

- [ ] **변수 누락**: 사용자에게 명확한 에러 메시지
- [ ] **클라이언트 정보 없음**: 이메일/전화번호 없을 때 처리
- [ ] **템플릿 로드 실패**: 기본 템플릿 사용 또는 에러 표시

#### 9.3 성능

- [ ] **템플릿 렌더링**: 빠른 렌더링 속도
- [ ] **변수 계산**: 메모이제이션으로 최적화
- [ ] **드래프트 로드**: 대량 드래프트 로드 시 성능

---

### 10. 개선 제안

#### 10.1 즉시 구현 가능

- [ ] **드래프트 저장 (로컬)**: localStorage 사용
- [ ] **템플릿 편집 UI**: 관리자 페이지에서 템플릿 편집
- [ ] **변수 수동 입력**: 자동 채워지지 않은 변수 수동 입력

#### 10.2 중기 개선

- [ ] **드래프트 저장 (서버)**: DB에 저장하여 여러 기기에서 접근
- [ ] **커스텀 템플릿**: 사용자 정의 템플릿 생성
- [ ] **템플릿 버전 관리**: 템플릿 변경 이력 추적

#### 10.3 장기 개선

- [ ] **AI 기반 템플릿**: AI로 템플릿 자동 생성
- [ ] **다국어 템플릿**: 영어/한국어 템플릿
- [ ] **템플릿 A/B 테스트**: 템플릿 효과 측정

---

## ✅ 체크리스트

### 필수 검토 (프로덕션 전)

- [ ] 모든 템플릿이 올바르게 렌더링되는지
- [ ] 변수 자동 채우기가 정확한지
- [ ] 이메일/SMS 앱 열기가 정상 작동하는지
- [ ] 환경 변수가 모두 설정되어 있는지
- [ ] 에러 처리가 적절한지

### 권장 검토

- [ ] 템플릿 톤이 비즈니스에 적합한지
- [ ] 템플릿 길이가 적절한지
- [ ] 사용자 피드백 반영 여부
- [ ] 드래프트 기능 필요 여부

---

## 📝 참고 파일

- **컴포넌트**: `src/components/messages/MessageComposer.tsx`
- **템플릿 정의**: `src/types/messageTemplates.ts`
- **렌더링 유틸**: `src/utils/renderTemplate.ts`
- **Contact Log**: `src/app/clients/components/ContactLog.tsx`

---

## 🚀 구현 우선순위

### Phase 1: 기본 기능 개선 (1-2일)

1. 드래프트 저장 (localStorage)
2. 드래프트 불러오기
3. 변수 수동 입력

### Phase 2: 고급 기능 (3-5일)

1. 드래프트 저장 (서버)
2. 템플릿 편집 UI
3. 커스텀 템플릿

### Phase 3: 통합 및 최적화 (2-3일)

1. Contact Log 자동 연동
2. Calendar/Sales 연동
3. 성능 최적화

---

**검토자**: **\*\***\_\_\_**\*\***  
**검토일**: **\*\***\_\_\_**\*\***  
**다음 검토일**: **\*\***\_\_\_**\*\***
