# Sales History 사용자 가이드

## 📋 목차

1. [개요](#개요)
2. [페이지 접근 방법](#페이지-접근-방법)
3. [판매 기록 자동 생성](#판매-기록-자동-생성)
4. [환불 처리](#환불-처리)
5. [환불 취소 (Undo)](#환불-취소-undo)
6. [필터링 및 검색](#필터링-및-검색)
7. [차트 및 인사이트 활용](#차트-및-인사이트-활용)
8. [영수증 발송](#영수증-발송)
9. [자주 묻는 질문 (FAQ)](#자주-묻는-질문-faq)

---

## 개요

Sales History 페이지는 모든 판매 이력을 한눈에 보고 관리할 수 있는 대시보드입니다. 판매 기록 조회, 환불 처리, 통계 분석, 영수증 발송 등의 기능을 제공합니다.

### 주요 기능

- ✅ **자동 판매 기록**: Dashboard에서 악기 상태를 'Sold'로 변경하면 자동으로 판매 기록 생성
- ✅ **자동 환불 처리**: Dashboard에서 'Sold' 상태를 다른 상태로 변경하면 자동 환불
- ✅ **수동 환불/취소**: Sales History 페이지에서 직접 환불 처리 및 취소 가능
- ✅ **날짜 필터링**: 특정 기간의 판매 이력만 조회
- ✅ **검색 기능**: 메모(notes) 내용으로 검색
- ✅ **정렬 기능**: 날짜, 가격, 고객명 기준 정렬
- ✅ **데이터 시각화**: 다양한 차트로 판매 패턴 분석
- ✅ **인사이트 제공**: 월간 성장률, 트렌드 분석 등
- ✅ **알림 기능**: 매출 급감, 환불 급증 등 이상 징후 감지
- ✅ **영수증 발송**: 이메일로 영수증 발송

---

## 페이지 접근 방법

1. 사이드바에서 **"Sales"** 메뉴를 클릭합니다.
2. Sales History 페이지가 열리면 최근 판매 기록이 표시됩니다.

---

## 판매 기록 자동 생성

### Dashboard에서 판매 기록 자동 생성

**가장 간편한 방법**: Dashboard에서 악기 상태를 변경하면 자동으로 판매 기록이 생성됩니다.

#### 단계별 가이드

1. **Dashboard 페이지로 이동**
   - 사이드바에서 "Dashboard" 클릭

2. **악기 찾기**
   - 목록에서 판매할 악기를 찾거나 검색 기능 사용

3. **악기 상태 변경**
   - 악기 항목을 클릭하여 편집 모달 열기
   - **Status** 드롭다운에서 **"Sold"** 선택
   - 필요시 **Price** (판매 가격) 확인/수정
   - **Client** 연결이 있다면 자동으로 연결됨

4. **저장**
   - "Save" 버튼 클릭
   - ✅ **자동으로 판매 기록이 생성됩니다!**

#### 자동 생성되는 정보

- **판매 가격**: 악기의 가격 (Price 필드)
- **판매 날짜**: 오늘 날짜
- **고객 정보**: 악기와 연결된 'Sold' 관계의 고객 (있는 경우)
- **악기 정보**: 판매된 악기 ID
- **메모**: "Auto-created when instrument status changed to Sold"

> 💡 **팁**: Dashboard에서 판매를 기록하면 Sales History 페이지에서 바로 확인할 수 있습니다.

---

## 환불 처리

환불은 두 가지 방법으로 처리할 수 있습니다:

### 방법 1: Dashboard에서 자동 환불 (권장)

**가장 직관적인 방법**: Dashboard에서 악기 상태를 'Sold'에서 다른 상태로 변경하면 자동으로 환불 처리됩니다.

#### 단계별 가이드

1. **Dashboard 페이지로 이동**

2. **환불할 악기 찾기**
   - 현재 상태가 "Sold"인 악기를 찾습니다

3. **상태 변경**
   - 악기 항목을 클릭하여 편집 모달 열기
   - **Status** 드롭다운에서 **"Sold"가 아닌 다른 상태** 선택
     - 예: "Available", "On Loan", "Repair" 등
   - "Save" 버튼 클릭

4. **자동 환불 처리 확인**
   - ✅ 해당 악기의 최근 판매 기록이 자동으로 환불 처리됩니다
   - Sales History 페이지에서 환불된 기록을 확인할 수 있습니다

#### 자동 환불 시 기록되는 정보

- **환불 금액**: 원래 판매 가격의 음수 값
- **메모**: "Auto-refunded when instrument status changed from Sold to [새 상태] on [날짜]"

> ⚠️ **주의**: 여러 번 판매 기록이 있는 경우, 가장 최근 판매 기록만 환불 처리됩니다.

### 방법 2: Sales History에서 수동 환불

특정 판매 기록만 환불하고 싶을 때 사용합니다.

#### 단계별 가이드

1. **Sales History 페이지로 이동**

2. **환불할 판매 기록 찾기**
   - 테이블에서 환불할 판매 항목 찾기

3. **환불 버튼 클릭**
   - 해당 행의 **"Refund"** 버튼 클릭 (빨간색 버튼)
   - 확인 메시지 없이 즉시 환불 처리됩니다

4. **환불 확인**
   - ✅ 판매 기록의 상태가 "Refunded"로 변경됩니다
   - 가격이 음수로 표시됩니다
   - 메모에 환불 날짜가 자동 추가됩니다

---

## 환불 취소 (Undo)

실수로 환불했거나 환불을 취소하고 싶을 때 사용합니다.

### 단계별 가이드

1. **Sales History 페이지로 이동**

2. **환불 취소할 기록 찾기**
   - 테이블에서 상태가 **"Refunded"**인 항목 찾기
   - 가격이 음수로 표시된 항목

3. **Undo Refund 버튼 클릭**
   - 해당 행의 **"Undo Refund"** 버튼 클릭 (초록색 버튼)
   - 확인 메시지 없이 즉시 환불 취소됩니다

4. **취소 확인**
   - ✅ 판매 기록이 원래 상태로 복원됩니다
   - 가격이 양수로 변경됩니다
   - 메모에 취소 날짜가 자동 추가됩니다

> 💡 **팁**: Dashboard에서 상태를 다시 'Sold'로 변경해도 환불 취소는 되지 않습니다. Sales History 페이지에서만 환불 취소가 가능합니다.

---

## 필터링 및 검색

### 날짜 필터링

특정 기간의 판매 기록만 조회할 수 있습니다.

#### 사용 방법

1. **From Date (시작 날짜)**
   - 날짜 입력 필드에 시작 날짜 입력 (YYYY-MM-DD 형식)
   - 예: `2024-01-01`

2. **To Date (종료 날짜)**
   - 날짜 입력 필드에 종료 날짜 입력
   - 예: `2024-12-31`

3. **자동 적용**
   - 날짜를 입력하면 자동으로 필터가 적용됩니다
   - 테이블과 차트가 모두 해당 기간으로 업데이트됩니다

#### 빠른 기간 선택 (Quick Presets)

페이지 상단에 자주 사용하는 기간 버튼이 있습니다:

- **Last 7 days**: 최근 7일
- **This month**: 이번 달
- **Last month**: 지난 달
- **Last 3 months**: 최근 3개월
- **Last 12 months**: 최근 12개월

> 💡 **팁**: 빠른 기간 버튼을 클릭하면 From/To 날짜가 자동으로 설정됩니다.

### 검색 기능

메모(notes) 내용으로 검색할 수 있습니다.

#### 사용 방법

1. **검색 입력 필드**에 키워드 입력
2. **Enter 키** 또는 자동으로 검색 실행
3. 메모에 해당 키워드가 포함된 판매 기록만 표시됩니다

> ⚠️ **참고**: 현재는 메모(notes) 필드만 검색됩니다. 고객명이나 악기명으로는 검색되지 않습니다.

### 정렬 기능

테이블 헤더를 클릭하여 정렬할 수 있습니다.

#### 정렬 가능한 컬럼

- **Date**: 판매 날짜 기준 (기본값: 최신순)
- **Price**: 판매 가격 기준
- **Client**: 고객명 기준 (알파벳 순)

#### 사용 방법

1. 정렬하고 싶은 컬럼 헤더 클릭
2. 첫 클릭: 오름차순 (↑)
3. 두 번째 클릭: 내림차순 (↓)
4. 화살표 아이콘으로 현재 정렬 방향 확인 가능

---

## 차트 및 인사이트 활용

### 요약 카드 (Summary Cards)

페이지 상단에 4개의 요약 카드가 표시됩니다:

- **Revenue**: 총 매출 (환불 제외)
- **Orders**: 총 주문 수
- **Avg. Ticket**: 평균 티켓 가격
- **Refunded**: 총 환불 금액
- **Refund Rate**: 환불률 (%)

> 💡 **팁**: 날짜 필터를 적용하면 해당 기간의 통계만 표시됩니다.

### 인사이트 (Insights)

**Sales Insights** 섹션에서 다음 정보를 확인할 수 있습니다:

- **Month-over-Month (MoM) 성장률**: 이번 달 vs 지난 달 매출/주문/고객 수 비교
- **최근 트렌드**: 최근 7일 vs 이전 7일 매출 변화
- **고객 vs 티켓 분석**: 매출 변화가 고객 수 증가인지, 평균 티켓 상승인지 분석

### 알림 (Alerts)

**Sales Alerts** 섹션에서 이상 징후를 감지합니다:

- ⚠️ **매출 급감**: 최근 7일 매출이 이전 7일 대비 20% 이상 감소
- ⚠️ **환불 급증**: 최근 7일 환불이 이전 7일 대비 50% 이상 증가
- ⚠️ **특정 제조사 환불 증가**: 특정 제조사의 환불이 급증한 경우
- ⚠️ **특정 요일 주문 급락**: 특정 요일의 주문이 급격히 감소한 경우

### 차트 (Charts)

다양한 차트로 판매 패턴을 시각적으로 확인할 수 있습니다:

#### 1. Daily Trend Chart (일별 트렌드)
- 목적: 일별 매출/주문 변동 및 이상 감지
- 표시 정보: Revenue, Net Sales, Orders, Refunds

#### 2. Sales by Day of Week (요일별 판매)
- 목적: 요일별 판매 패턴 파악
- 표시 정보: 요일별 Revenue, Orders

#### 3. Monthly Sales Comparison (월별 비교)
- 목적: 월간 성장 추세 추적
- 표시 정보: 월별 Revenue, Orders, Refund Rate

#### 4. Top Instruments by Revenue (매출 기준 인기 악기)
- 목적: 가장 많이 팔리는 악기 파악
- 표시 정보: 상위 10개 악기의 Revenue, Net Revenue, Orders

#### 5. Top Makers by Revenue (매출 기준 인기 제조사)
- 목적: 가장 인기 있는 제조사 파악
- 표시 정보: 상위 10개 제조사의 Revenue, Net Revenue, Orders

#### 6. Refunds by Client (고객별 환불)
- 목적: 환불이 많은 고객 파악
- 표시 정보: 상위 10개 고객의 환불 금액 및 건수

#### 7. Refunds by Instrument (악기별 환불)
- 목적: 환불이 많은 악기 라인 파악
- 표시 정보: 상위 10개 악기의 환불 금액 및 건수

#### 차트 인터랙션

- **클릭하여 필터링**: 일별/월별 차트의 특정 날짜/월을 클릭하면 해당 기간으로 필터가 자동 설정됩니다
- **고객/악기 필터링**: 환불 차트의 특정 바를 클릭하면 해당 고객/악기로 검색어가 자동 설정됩니다

> ⚠️ **주의**: 데이터가 부족하거나 희소한 경우 일부 차트는 표시되지 않을 수 있습니다. 페이지 상단에 데이터 품질 경고가 표시됩니다.

---

## 영수증 발송

고객에게 이메일로 영수증을 발송할 수 있습니다.

### 단계별 가이드

1. **Sales History 페이지에서 판매 기록 찾기**
   - 영수증을 발송할 판매 항목 찾기

2. **Receipt 버튼 클릭**
   - 해당 행의 **"Receipt"** 버튼 클릭 (파란색 버튼)

3. **이메일 클라이언트 열기**
   - 기본 이메일 클라이언트가 열립니다 (예: Mail, Outlook)
   - 수신자, 제목, 본문이 자동으로 채워집니다

4. **이메일 확인 및 발송**
   - 이메일 내용 확인
   - "Send" 버튼 클릭하여 발송

### 자동 생성되는 이메일 내용

- **수신자**: 고객 이메일 주소
- **제목**: "Receipt for Sale #[판매 ID 일부]"
- **본문**:
  - 고객 인사말
  - 판매 날짜
  - 판매 금액
  - 악기 정보 (있는 경우)
  - 메모 (있는 경우)
  - 감사 인사

> ⚠️ **주의**: 고객 이메일이 없는 경우 영수증을 발송할 수 없습니다. "No customer email available" 오류가 표시됩니다.

---

## 자주 묻는 질문 (FAQ)

### Q1. Dashboard에서 악기를 'Sold'로 변경했는데 Sales History에 기록이 안 보여요.

**A**: 다음을 확인해보세요:
- 페이지를 새로고침해보세요
- 날짜 필터가 적용되어 있는지 확인하세요 (필터 초기화 시도)
- 악기 가격(Price)이 설정되어 있는지 확인하세요 (가격이 없으면 판매 기록이 생성되지 않을 수 있음)

### Q2. 환불을 취소하고 싶어요.

**A**: Sales History 페이지에서 환불된 항목(가격이 음수)의 **"Undo Refund"** 버튼을 클릭하세요.

### Q3. 여러 번 판매 기록이 있는 악기를 환불하면 어떻게 되나요?

**A**: Dashboard에서 상태를 변경하면 **가장 최근 판매 기록**만 환불 처리됩니다. 특정 판매 기록만 환불하려면 Sales History 페이지에서 직접 환불하세요.

### Q4. 차트가 표시되지 않아요.

**A**: 다음 이유로 차트가 숨겨질 수 있습니다:
- 데이터가 너무 적음 (10건 미만)
- 날짜 범위가 너무 넓어서 데이터가 희소함
- 해당 기간에 판매 기록이 없음

페이지 상단의 데이터 품질 경고를 확인하세요.

### Q5. 검색이 제대로 안 돼요.

**A**: 현재는 **메모(notes) 필드만** 검색됩니다. 고객명이나 악기명으로는 검색되지 않습니다. 메모에 관련 정보를 추가하거나, 테이블에서 직접 찾아보세요.

### Q6. 영수증을 이메일로 보낼 수 없어요.

**A**: 다음을 확인하세요:
- 고객 정보에 이메일 주소가 등록되어 있는지 확인
- 고객이 연결되어 있는지 확인 (판매 기록에 고객 정보가 없으면 발송 불가)

### Q7. 판매 기록을 수정하거나 삭제할 수 있나요?

**A**: 현재는 판매 기록 수정/삭제 기능이 없습니다. 환불 처리로 취소하거나, 필요시 데이터베이스에서 직접 수정해야 합니다.

### Q8. Dashboard에서 악기 상태를 변경했는데 환불이 안 돼요.

**A**: 다음을 확인하세요:
- 악기가 이전에 'Sold' 상태였는지 확인
- 해당 악기의 판매 기록이 있는지 확인 (Sales History 페이지에서 확인)
- 브라우저 콘솔에 오류 메시지가 있는지 확인

### Q9. 날짜 필터를 초기화하고 싶어요.

**A**: From Date와 To Date 입력 필드를 비우면 전체 기간의 데이터가 표시됩니다.

### Q10. 페이지네이션이 작동하지 않아요.

**A**: 다음을 확인하세요:
- 날짜 필터가 너무 좁게 설정되어 있는지 확인
- 검색어가 너무 구체적이어서 결과가 적은지 확인
- 페이지 번호를 직접 클릭해보세요 (First/Last 버튼 외에)

---

## 💡 유용한 팁

1. **자동화 활용**: 가능한 한 Dashboard에서 상태 변경을 통해 판매/환불을 처리하세요. 수동 입력보다 빠르고 정확합니다.

2. **정기적인 확인**: 매주 또는 매월 Sales History 페이지를 확인하여 판매 패턴과 트렌드를 파악하세요.

3. **알림 활용**: Sales Alerts 섹션을 주의 깊게 확인하여 이상 징후를 조기에 발견하세요.

4. **차트 활용**: 특정 기간의 차트를 클릭하여 해당 기간의 상세 데이터를 빠르게 확인하세요.

5. **메모 활용**: 판매 기록 생성 시 메모를 추가하면 나중에 검색이 쉬워집니다.

---

## 📞 지원

문제가 발생하거나 질문이 있으시면 개발팀에 문의하세요.

**마지막 업데이트**: 2024년 12월
