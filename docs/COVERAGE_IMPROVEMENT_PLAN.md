# 테스트 커버리지 80% 달성 계획

**현재 커버리지**: 약 69% (Statements 기준)  
**목표 커버리지**: 80%  
**필요 증가**: 약 11%

## 진행 상황

### ✅ 완료된 작업

1. **withAuthRoute.ts 테스트 추가**
   - 현재 커버리지: 23.25% → 목표 70%+
   - 16개 테스트 케이스 작성
   - 주요 인증 경로 테스트 완료

### 📋 우선순위별 작업 계획

#### 1순위: 낮은 커버리지 핵심 파일 (효과 큼)

1. **withAuthRoute.ts** ✅ 진행 중
   - 현재: 23.25%
   - 목표: 70%+
   - 상태: 테스트 작성 완료, 일부 테스트 수정 필요

2. **기타 API 유틸리티 파일들**
   - `withSentryRoute.ts`: 62.5%
   - `apiHandler.ts`: 93.54% (이미 높음)

#### 2순위: 컴포넌트 테스트 보완

1. **ClientRowExpand.tsx**
   - 현재: 테스트 있으나 커버리지 확인 필요
   - 상태: `__tests__/ClientRowExpand.test.tsx` 존재

2. **TodayFollowUps.tsx**
   - 현재: 테스트 있으나 커버리지 확인 필요
   - 상태: `__tests__/TodayFollowUps.test.tsx` 존재

3. **SalesFilters.tsx**
   - 현재: 테스트 있음
   - 상태: `__tests__/SalesFilters.test.tsx` 존재

#### 3순위: 기존 테스트 커버리지 향상

1. **엣지 케이스 추가**
   - 기존 테스트에 누락된 엣지 케이스 추가
   - 에러 핸들링 경로 추가

2. **브랜치 커버리지 개선**
   - 현재 Branches: 56.54% (목표: 70%+)
   - 조건문/분기 테스트 추가

## 실행 계획

### 단계 1: withAuthRoute 테스트 수정 및 완료

- [ ] 실패하는 테스트 케이스 수정
- [ ] 모든 테스트 통과 확인
- [ ] 커버리지 확인

### 단계 2: 낮은 커버리지 파일 확인

```bash
npm run test:coverage
# 커버리지 리포트에서 80% 미만 파일 확인
```

### 단계 3: 우선순위에 따라 테스트 추가

- 가장 효과가 큰 파일부터 진행
- 각 파일당 최소 70% 이상 커버리지 달성

### 단계 4: 최종 검증

```bash
npm run test:coverage
# 전체 커버리지 80% 이상 확인
```

## 참고사항

- `withAuthRoute.ts`는 내부 함수 `getUserFromRequest`를 가지고 있어 테스트가 복잡함
- 환경 변수 조작이 필요한 테스트들이 있어 신중한 접근 필요
- 기존 테스트 패턴을 따라 일관성 유지
