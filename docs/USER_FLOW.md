# 사용자 플로우 (User Flow)

이 문서는 Instrument Inventory App의 사용자 관점에서의 웹 앱 플로우를 정리합니다.

## 목차
1. [인증 플로우](#인증-플로우)
2. [메인 기능 플로우](#메인-기능-플로우)
3. [페이지별 상세 플로우](#페이지별-상세-플로우)
4. [네비게이션 구조](#네비게이션-구조)

---

## 인증 플로우

### 1. 초기 접근
```
사용자 → 앱 접속 (/)
  ├─ 로그인 상태 확인
  │   ├─ ✅ 로그인됨 → /dashboard 리다이렉트
  │   └─ ❌ 로그인 안 됨 → 로그인 페이지 표시
```

### 2. 로그인 프로세스
```
로그인 페이지 (/)
  ├─ 이메일/비밀번호 입력
  ├─ "Sign in" 버튼 클릭
  ├─ 인증 처리
  │   ├─ ✅ 성공 → /dashboard 리다이렉트
  │   └─ ❌ 실패 → 에러 메시지 표시
  └─ "Create an account" 링크 → /signup
```

### 3. 회원가입 프로세스
```
회원가입 페이지 (/signup)
  ├─ 이메일/비밀번호 입력
  ├─ "Sign up" 버튼 클릭
  ├─ 계정 생성 처리
  │   ├─ ✅ 성공 → /dashboard 리다이렉트 (자동 로그인)
  │   └─ ❌ 실패 → 에러 메시지 표시
  └─ "Sign in" 링크 → / (로그인 페이지로 복귀)
```

### 4. 로그아웃
```
어느 페이지에서든
  ├─ 헤더의 "SignOut" 버튼 클릭
  ├─ 세션 종료 처리
  └─ / (로그인 페이지)로 리다이렉트
```

### 5. 보호된 라우트
```
모든 기능 페이지는 ProtectedRoute로 보호됨
  ├─ 로그인 안 됨 → / 리다이렉트
  └─ 로그인 됨 → 페이지 정상 표시
```

---

## 메인 기능 플로우

### 전체 개요
```
로그인 완료 → 대시보드 (/dashboard)
  ├─ 사이드바 메뉴 표시
  │   ├─ Items (Dashboard)
  │   ├─ Clients
  │   ├─ Connected Clients
  │   ├─ Calendar
  │   ├─ Client Analytics
  │   └─ Sales
  └─ 각 메뉴 클릭 → 해당 기능 페이지로 이동
```

---

## 페이지별 상세 플로우

### 1. Dashboard (Items) - `/dashboard`

**목적**: 악기(Instrument) 재고 관리 및 전체 현황 파악

**주요 기능**:
- 악기 목록 조회
- 악기 추가/수정/삭제
- 필터링 (타입, 제작자, 상태 등)
- 검색
- 소유권(Ownership) 확인 및 연결된 클라이언트 확인

**사용자 플로우**:
```
대시보드 접속
  ├─ 악기 목록 표시 (로딩 중...)
  ├─ 필터/검색으로 원하는 악기 찾기
  ├─ 악기 추가
  │   └─ "Add Item" 버튼 → 폼 모달 열기 → 입력 → 저장
  ├─ 악기 수정
  │   └─ 행 클릭 → 편집 모드 → 수정 → 저장
  ├─ 악기 삭제
  │   └─ 삭제 버튼 → 확인 → 삭제
  └─ 소유권 확인
      └─ Ownership 컬럼에서 클라이언트 이름 클릭 → /clients 페이지로 이동
```

**데이터 표시**:
- Serial Number
- Type (Violin, Viola, Cello, Bow 등)
- Maker
- Ownership (클라이언트 이름 또는 UUID)
- Status
- Price
- Received Date
- Certificate

---

### 2. Clients - `/clients`

**목적**: 클라이언트(고객) 관리

**주요 기능**:
- 클라이언트 목록 조회
- 클라이언트 추가/수정/삭제
- 필터링 (태그, 관심사, 상태 등)
- 검색
- 클라이언트별 악기 관계 확인

**사용자 플로우**:
```
클라이언트 페이지 접속
  ├─ 클라이언트 목록 표시
  ├─ 필터/검색으로 원하는 클라이언트 찾기
  ├─ 클라이언트 추가
  │   └─ "Add Client" 버튼 → 폼 모달 열기 → 입력 → 저장
  ├─ 클라이언트 수정
  │   └─ 클라이언트 카드/행 클릭 → 편집 모드 → 수정 → 저장
  ├─ 클라이언트 삭제
  │   └─ 삭제 버튼 → 확인 → 삭제
  └─ 클라이언트 상세
      ├─ 클라이언트 정보 확인
      ├─ 연결된 악기 목록 확인
      └─ 소유한 악기 목록 확인
```

**데이터 표시**:
- First Name, Last Name
- Email
- Phone
- Tags
- Interests
- Notes
- 연결된 악기 관계

---

### 3. Connected Clients - `/connections`

**목적**: 악기-클라이언트 연결(Connection/Relationship) 관리

**주요 기능**:
- 연결 목록 조회
- 연결 추가/수정/삭제
- 관계 타입 관리 (Owned, Interested, Loaned 등)
- 필터링 및 그룹화

**사용자 플로우**:
```
Connections 페이지 접속
  ├─ 연결 목록 표시 (그룹화)
  ├─ 필터로 원하는 연결 찾기
  ├─ 연결 추가
  │   └─ "Add Connection" 버튼 → 폼 모달 열기
  │       ├─ 악기 선택
  │       ├─ 클라이언트 선택
  │       ├─ 관계 타입 선택
  │       └─ 저장
  ├─ 연결 수정
  │   └─ 연결 카드 클릭 → 편집 모달 → 수정 → 저장
  └─ 연결 삭제
      └─ 삭제 버튼 → 확인 → 삭제
```

**관계 타입**:
- Owned (소유)
- Interested (관심 있음)
- Loaned (대여)
- Repaired (수리)
- 기타 커스텀 관계

---

### 4. Calendar - `/calendar`

**목적**: 유지보수 작업(Maintenance Tasks) 일정 관리

**주요 기능**:
- 캘린더 뷰 (월/주/일/연도/타임라인)
- 작업 일정 조회
- 작업 추가/수정/삭제
- 필터링 및 검색
- 날짜별 작업 상태 확인

**사용자 플로우**:
```
캘린더 페이지 접속
  ├─ 현재 뷰 선택 (Month/Week/Agenda/Year/Timeline)
  ├─ 날짜 네비게이션 (이전/다음/오늘)
  ├─ 작업 확인
  │   └─ 이벤트 클릭 → 작업 상세 확인
  ├─ 작업 추가
  │   └─ 날짜 클릭 → 폼 모달 열기
  │       ├─ 제목, 설명 입력
  │       ├─ 악기 선택
  │       ├─ 날짜/우선순위 설정
  │       └─ 저장
  ├─ 작업 수정/삭제
  │   └─ 작업 클릭 → 상세/편집 모달 → 수정/삭제
  └─ 필터링
      └─ 상태/우선순위/악기로 필터링
```

**뷰 종류**:
- **Month**: 월별 달력 뷰
- **Week**: 주별 뷰
- **Agenda**: 목록 형태
- **Year**: 연도 전체 뷰
- **Timeline**: 타임라인 뷰

**작업 상태**:
- Pending (대기)
- In Progress (진행 중)
- Completed (완료)
- Cancelled (취소)

**작업 우선순위**:
- Urgent (긴급)
- High (높음)
- Medium (보통)
- Low (낮음)

---

### 5. Client Analytics - `/clients/analytics`

**목적**: 클라이언트별 구매 이력 및 통계 분석

**주요 기능**:
- 클라이언트별 구매 이력 조회
- 구매 통계 (총액, 건수 등)
- 구매한 악기 목록
- 차트 및 시각화

**사용자 플로우**:
```
Client Analytics 페이지 접속
  ├─ 클라이언트 목록 표시
  ├─ 클라이언트 선택
  │   └─ 클라이언트 클릭 → 해당 클라이언트의 구매 이력 표시
  ├─ 통계 확인
  │   ├─ 총 구매액
  │   ├─ 구매 건수
  │   ├─ 구매한 악기 목록
  │   └─ 구매 차트
  └─ 필터링
      └─ 날짜 범위, 악기 타입 등으로 필터링
```

**표시 정보**:
- 클라이언트 정보
- 구매 이력 (날짜, 악기, 가격)
- 총 구매액
- 평균 구매액
- 구매 빈도

---

### 6. Sales - `/sales`

**목적**: 판매 기록 관리 및 분석

**주요 기능**:
- 판매 기록 목록 조회
- 판매 추가/수정/삭제
- 판매 통계 및 차트
- 필터링 (날짜, 클라이언트, 악기 등)

**사용자 플로우**:
```
Sales 페이지 접속
  ├─ 판매 기록 목록 표시
  ├─ 판매 통계 확인
  │   ├─ 총 매출
  │   ├─ 기간별 매출
  │   └─ 다양한 차트 (일별, 요일별, 월별, Maker별, 악기 타입별)
  ├─ 판매 추가
  │   └─ "Add Sale" 버튼 → 폼 모달 열기
  │       ├─ 날짜 선택
  │       ├─ 악기 선택
  │       ├─ 클라이언트 선택
  │       ├─ 가격 입력
  │       └─ 저장
  ├─ 판매 수정/삭제
  │   └─ 판매 기록 클릭 → 편집 → 수정/삭제
  └─ 필터링
      └─ 날짜 범위, 클라이언트, 악기로 필터링
```

**차트 종류**:
- Daily Sales Trend (일별 매출 추이)
- Sales by Day of Week (요일별 매출)
- Monthly Sales Comparison (월별 매출 비교)
- Top Instruments by Revenue (악기별 매출 순위)
- Top Makers by Revenue (제작자별 매출 순위)
- Refund Analysis (환불 분석)

---

### 7. Instruments - `/instruments`

**목적**: 악기 관리 (별도 페이지, Dashboard와 유사하거나 다른 관점)

**주요 기능**:
- 악기 목록 조회
- 악기 상세 정보
- 클라이언트 검색 및 연결

**사용자 플로우**:
```
Instruments 페이지 접속
  ├─ 악기 목록 표시
  ├─ 악기 상세 확인
  │   └─ 악기 클릭 → 상세 정보 표시
  └─ 클라이언트 연결
      └─ 클라이언트 검색 → 연결
```

---

### 8. Customer - `/customer`

**목적**: 고객 상세 정보 및 구매 이력

**주요 기능**:
- 고객 검색
- 고객 상세 정보
- 구매 이력
- 통계

**사용자 플로우**:
```
Customer 페이지 접속
  ├─ 고객 검색
  ├─ 고객 선택
  │   └─ 검색 결과에서 고객 클릭
  ├─ 고객 상세 정보 확인
  │   ├─ 기본 정보
  │   ├─ 구매 이력
  │   ├─ 구매 통계
  │   └─ 연결된 악기
  └─ 액션
      ├─ 고객 정보 수정
      └─ 새 판매 기록 추가
```

---

## 네비게이션 구조

### 사이드바 메뉴 (고정)

```
┌─────────────────────────────┐
│  Inventory App              │
├─────────────────────────────┤
│  📦 Items                   │  → /dashboard
│  👥 Clients                 │  → /clients
│  📄 Connected Clients       │  → /connections
│  📅 Calendar                │  → /calendar
│  📊 Client Analytics        │  → /clients/analytics
│  💰 Sales                   │  → /sales
└─────────────────────────────┘
```

### 헤더 (모든 페이지 상단)

```
┌─────────────────────────────────────────────────────┐
│ [☰] Page Title          [User Email] [SignOut] [Add]│
└─────────────────────────────────────────────────────┘
```

**헤더 구성 요소**:
- 햄버거 메뉴 아이콘: 사이드바 토글
- 페이지 제목: 현재 페이지 이름
- 사용자 이메일: 로그인한 사용자 표시
- SignOut 버튼: 로그아웃
- Add 버튼 (선택적): 페이지별 "추가" 액션 (있을 경우)

---

## 주요 사용자 시나리오

### 시나리오 1: 새 악기 등록 및 클라이언트 연결
```
1. Dashboard 접속
2. "Add Item" 클릭
3. 악기 정보 입력 (Serial Number, Type, Maker, Price 등)
4. 저장
5. Connections 페이지 이동
6. "Add Connection" 클릭
7. 방금 추가한 악기 선택
8. 클라이언트 선택
9. 관계 타입 선택 (예: Owned)
10. 저장
```

### 시나리오 2: 유지보수 작업 일정 추가
```
1. Calendar 접속
2. 원하는 날짜 클릭 (또는 뷰에서 날짜 선택)
3. 작업 정보 입력 (제목, 악기, 우선순위, 설명 등)
4. 저장
5. 캘린더에서 작업 확인
```

### 시나리오 3: 판매 기록 추가 및 분석 확인
```
1. Sales 페이지 접속
2. "Add Sale" 클릭
3. 판매 정보 입력 (날짜, 악기, 클라이언트, 가격)
4. 저장
5. 판매 통계 차트에서 업데이트된 데이터 확인
6. Maker별 또는 악기 타입별 매출 확인
```

### 시나리오 4: 클라이언트 구매 이력 확인
```
1. Client Analytics 접속
2. 클라이언트 목록에서 원하는 클라이언트 선택
3. 구매 이력 및 통계 확인
4. 필요시 Sales 페이지에서 상세 판매 기록 확인
```

---

## 데이터 흐름

### 로딩 플로우
```
페이지 접속
  ├─ 인증 확인 (AuthContext)
  ├─ 데이터 로딩 시작 (DataContext)
  │   ├─ Instruments 로딩
  │   ├─ Clients 로딩
  │   ├─ Connections 로딩
  │   └─ 기타 필요한 데이터 로딩
  ├─ 로딩 상태 표시
  └─ 데이터 로딩 완료 → UI 업데이트
```

### 상태 관리
- **AuthContext**: 인증 상태 (user, session, loading)
- **DataContext**: 전역 데이터 상태 (instruments, clients, connections, sales 등)
- **페이지별 로컬 상태**: 필터, 검색어, 선택된 항목 등

---

## 에러 처리

### 인증 에러
- 로그인 실패 → 에러 메시지 표시
- 세션 만료 → 자동으로 로그인 페이지로 리다이렉트
- 토큰 갱신 실패 → 로그아웃 처리

### 데이터 에러
- API 에러 → 에러 메시지 표시 (Toast/Alert)
- 로딩 실패 → 재시도 옵션 제공
- 데이터 없음 → Empty State 표시

---

## 접근성 및 사용성

### 반응형 디자인
- 모바일, 태블릿, 데스크톱 지원
- 사이드바 접기/펼치기 (모바일에서 자동 접힘)

### 키보드 네비게이션
- Tab 키로 포커스 이동
- Enter/Space로 액션 실행
- Esc로 모달 닫기

### 피드백
- 로딩 상태 표시
- 성공/실패 Toast 알림
- 에러 메시지 명확히 표시

---

## 업데이트 내역

- 2024-12-11: 초기 문서 작성
