# 남은 작업 목록 (Remaining Tasks)

**최종 업데이트**: 2025-12-11  
**상태**: Critical 완료, High는 인증/인가만 남음

---

## ✅ 완료된 작업 요약

### Critical 우선순위 (100% 완료)
- ✅ 데이터 페칭 전략 통일 (Context API)
- ✅ 성능 최적화 (O(n²) → O(n), Map 기반 조회)
- ✅ useMemo/useCallback 일관성
- ✅ Serial # 규칙 확장 (2자리 접두사 + 7자리 숫자)
- ✅ 이메일 아이콘 기능 (mailto 템플릿)
- ✅ View vs Edit 구분 및 Accordion 구현
- ✅ Instrument 연결 정확도 개선
- ✅ Connected Clients 섹션 단순화
- ✅ 캘린더 검색 확장 (다중 필드 검색, 정렬, 하이라이트)

### High 우선순위 (100% 완료)
- ✅ API 라우트 일관성 (모든 주요 CRUD 작업)
- ✅ 코드 중복 제거 (필터/폼 로직 공통화)
- ✅ 고유 번호 기능 (악기/클라이언트)
- ✅ 캘린더 기능 개선 (client_id 추가, 그룹화 표시)
- ✅ 대용량 리스트 가상화 (Dashboard, Clients, Instruments)
- ✅ 타입 가드 추가 (Zod 기반 런타임 타입 검증)
- ✅ 입력 검증 강화 (서버/클라이언트 검증, SQL Injection 방지)
- ✅ 알림 시스템 Phase 1 & 2 (알림 배지, 브라우저 알림)

---

## 🔴 High 우선순위 (남은 작업)

### 1. 대용량 리스트 가상화
**상태**: 부분 완료 (Dashboard, Instruments에 적용됨)  
**우선순위**: ⭐⭐⭐⭐ (High)

**작업 내용**:
- [x] `react-window` 라이브러리 활용 (이미 설치됨)
- [x] Dashboard 리스트 가상화 적용 (50개 이상일 때 자동 활성화)
- [x] Clients 리스트 가상화 적용 (50개 이상일 때 자동 활성화)
- [x] Instruments 리스트 가상화 적용 (50개 이상일 때 자동 활성화)
- [x] 성능 최적화 (조건부 가상화로 오버헤드 최소화)

**예상 시간**: 1-2일 (완료)  
**예상 효과**: 대용량 데이터(1000+ 항목) 렌더링 성능 향상

---

### 2. 인증/인가 강화
**상태**: 기본 보안 조치 완료  
**우선순위**: ⭐⭐⭐ (Medium-High)

**작업 내용**:
- [ ] RLS (Row Level Security) 정책 검토 및 강화
- [ ] API 라우트 인증 미들웨어 추가
- [ ] 세션 관리 개선
- [ ] 권한 기반 접근 제어 구현

**예상 시간**: 3-5일  
**예상 효과**: 보안 취약점 제거, 프로덕션 준비

---

### 3. 데이터베이스 마이그레이션 실행 확인
**상태**: ✅ **완료 확인 (2025-12-12)**  
**우선순위**: ⭐⭐⭐ (Medium)

**작업 내용**:
- [x] Supabase pooler(us-east-2)에서 마이그레이션 실행
  - `20250101000000_add_client_id_to_maintenance_tasks.sql`
  - `20250101000001_add_unique_numbers.sql`
- [x] 스키마 변경사항 검증
- [x] `npm run schema:check` 실행 및 확인 (`supabase-schema-export.sql` 갱신)

**최종 확인 결과 (2025-12-12)**:
- ✅ `maintenance_tasks.client_id` 컬럼 존재 확인 (UUID, NULL 허용)
- ✅ `instruments.serial_number` 컬럼 존재 확인 (TEXT, NULL 허용)
- ✅ `clients.client_number` 컬럼 존재 확인 (TEXT, NULL 허용)
- ✅ 모든 인덱스 생성 확인 (`idx_maintenance_tasks_client_id`, `idx_instruments_serial_number`, `idx_clients_client_number`)
- ✅ Foreign Key 제약조건 확인 (`maintenance_tasks_client_id_fkey`)
- ✅ TypeScript 타입 정의 일치 확인 (`src/types/index.ts`)

**실행 로그 핵심**:
- `20250101000001_add_unique_numbers.sql` us-east-2 pooler 연결 성공 후 적용
- `npm run schema:check` 성공, 모든 테이블/컬럼/제약조건 확인됨

---

## 🟡 Medium 우선순위 (중기)

### 4. 타입 가드 추가
**상태**: ✅ 완료  
**우선순위**: ⭐⭐⭐ (Medium)

**작업 내용**:
- [x] 런타임 타입 검증 함수 추가
- [x] API 응답 타입 검증
- [x] Zod 스키마 검증 라이브러리 도입
- [x] 타입 가드 유틸리티 함수 생성

**완료된 작업**:
- ✅ Zod 라이브러리 설치 및 스키마 정의
- ✅ 타입 가드 유틸리티 함수 생성 (`typeGuards.ts`)
- ✅ API 라우트에 타입 검증 적용 (모든 주요 API)
- ✅ 런타임 타입 안정성 향상

**예상 시간**: 1-2일 (완료)  
**예상 효과**: 런타임 타입 안정성 향상, 버그 조기 발견

---

### 5. 입력 검증 강화
**상태**: ✅ 완료  
**우선순위**: ⭐⭐⭐ (Medium)

**작업 내용**:
- [x] 클라이언트 측 검증 강화 (validationUtils.ts)
- [x] 서버 측 검증 강화 (API 라우트)
- [x] Zod 스키마 검증 라이브러리 도입
- [x] SQL Injection 방지 재검토 및 문서화

**완료된 작업**:
- ✅ API 라우트 PATCH 요청 업데이트 데이터 검증 추가
- ✅ 동적 필드(orderBy 등) 화이트리스트 검증 추가
- ✅ 입력 값 sanitization 유틸리티 추가
- ✅ UUID 형식 검증 추가
- ✅ 날짜 형식 검증 추가
- ✅ 검색어 sanitization 추가
- ✅ 부분 업데이트 스키마 정의 (partial schemas)
- ✅ 보안 가이드 문서 작성

**예상 시간**: 2-3일 (완료)  
**예상 효과**: 보안 취약점 제거, 데이터 무결성 향상

---

### 6. 접근성 개선
**상태**: 부분 완료  
**우선순위**: ⭐⭐⭐ (Medium)

**작업 내용**:
- [ ] 모든 인터랙티브 요소에 ARIA 라벨 추가
- [ ] 키보드 네비게이션 개선
- [ ] 포커스 관리 개선
- [ ] 키보드 단축키 문서화
- [ ] 스크린 리더 테스트

**예상 시간**: 2-3일  
**예상 효과**: WCAG 2.1 AA 준수, 사용자 접근성 향상

---

### 7. E2E 테스트 확장
**상태**: 기본 설정 완료, 테스트 부족  
**우선순위**: ⭐⭐⭐ (Medium)

**작업 내용**:
- [ ] 주요 사용자 플로우 테스트 추가
  - [ ] 클라이언트 생성/수정/삭제 플로우
  - [ ] 악기 생성/수정/삭제 플로우
  - [ ] 연결 생성/수정/삭제 플로우
  - [ ] 캘린더 작업 생성/수정/삭제 플로우
  - [ ] 판매 기록 생성/수정/삭제 플로우
- [ ] Playwright 설정 최적화
- [ ] CI/CD 파이프라인에 E2E 테스트 통합

**예상 시간**: 3-5일  
**예상 효과**: 회귀 테스트 자동화, 배포 안정성 향상

---

### 8. 스킵된 테스트 처리
**상태**: ✅ 완료 (4개 스킵 해제 및 통과, 2025-12-11)  
**우선순위**: ⭐⭐ (Low-Medium)

**파일**:
- `src/app/clients/hooks/__tests__/useClients.mutations.test.tsx` (3개)
- `src/app/clients/hooks/__tests__/useClients.state.test.tsx` (1개)

**작업 내용**:
- [x] 스킵된 테스트 수정 및 활성화
- [x] 비동기 상태 관리 문제 해결
- [x] 테스트 실행 및 확인 (`npx jest src/app/clients/hooks/__tests__/useClients.mutations.test.tsx src/app/clients/hooks/__tests__/useClients.state.test.tsx`)

**결과**:
- 모든 테스트 통과 (7/7)
- 로딩/제출 상태 전환 및 CRUD 흐름 검증 완료

---

## 🔵 Low 우선순위 (장기)

### 9. 반응형 디자인 개선
**상태**: ✅ 완료  
**우선순위**: ⭐⭐ (Low)

**작업 내용**:
- [x] 모바일 레이아웃 테스트 및 개선
- [x] 터치 제스처 지원
- [x] 모바일 네비게이션 개선
- [x] 태블릿 레이아웃 최적화

**완료된 작업**:
- ✅ 모바일 사이드바 오버레이 구현
- ✅ 터치 제스처 훅 생성 (`useTouchGestures`)
- ✅ 모달 스와이프로 닫기 기능 추가
- ✅ 모바일 헤더 반응형 개선
- ✅ 테이블 모바일 스크롤 최적화
- ✅ 반응형 유틸리티 함수 생성 (`responsive.ts`)

**예상 시간**: 3-5일 (완료)  
**예상 효과**: 모바일 사용자 경험 향상

---

### 10. 문서화 보완
**상태**: 기본 문서화 완료  
**우선순위**: ⭐⭐ (Low)

**작업 내용**:
- [ ] API 문서화 (OpenAPI/Swagger)
- [ ] 아키텍처 다이어그램 업데이트
- [ ] 개발자 가이드 보완
- [ ] 코드 주석 보완 (JSDoc)

**예상 시간**: 2-3일  
**예상 효과**: 신규 개발자 온보딩 시간 단축

---

### 11. 에러 정보 노출 제한
**상태**: ✅ 완료  
**우선순위**: ⭐⭐ (Low-Medium)

**작업 내용**:
- [x] 프로덕션 환경에서 상세 에러 메시지 제한
- [x] 민감한 정보 로깅 방지
- [x] 에러 로깅 레벨 설정
- [x] 사용자 친화적 에러 메시지 표준화

**완료된 작업**:
- ✅ `errorSanitization.ts` 유틸리티 생성
- ✅ 프로덕션 환경 감지 및 민감한 정보 마스킹
- ✅ API 라우트에 안전한 에러 응답 적용 (`createSafeErrorResponse`)
- ✅ ErrorBoundary에 프로덕션 환경 필터링 적용
- ✅ Logger에 민감한 정보 마스킹 적용
- ✅ 사용자 친화적 에러 메시지 매핑

**예상 시간**: 1-2일 (완료)  
**예상 효과**: 보안 강화, 사용자 경험 개선

---

### 12. Certificate 기능 구현
**상태**: ✅ 완료  
**우선순위**: ⭐⭐ (Low)

**작업 내용**:
- [x] PDF 생성 라이브러리 설치 및 설정 (@react-pdf/renderer)
- [x] Certificate PDF 템플릿 생성
- [x] PDF 생성 기능 구현 (API route)
- [x] PDF 다운로드 기능 구현 (Dashboard 통합)

**완료된 작업**:
- ✅ `@react-pdf/renderer` 라이브러리 설치
- ✅ `CertificateDocument` 컴포넌트 생성 (한국어/영어 지원)
- ✅ `/api/certificates/[id]` API route 생성
- ✅ Dashboard ItemRow 및 ItemList에 Certificate 다운로드 버튼 추가
- ✅ RowActions 컴포넌트에 Certificate 메뉴 추가

**예상 시간**: 3-5일 (완료)

---

### 13. DB 인덱스 최적화 (선택사항)
**상태**: SQL 스크립트 제공됨, 수동 적용 필요  
**우선순위**: ⭐⭐ (Low)

**작업 내용**:
- [ ] Serial # 검색을 위한 복합 인덱스 생성
- [ ] 캘린더 검색을 위한 trigram/tsvector 인덱스 생성
- [ ] 성능 테스트 및 최적화

**예상 시간**: 1-2일

---

### 14. 페이지네이션/무한 스크롤 (선택사항)
**상태**: ✅ 완료 (페이지네이션 구현)  
**우선순위**: ⭐ (Very Low)

**작업 내용**:
- [x] 캘린더 검색 결과 페이지네이션
- [x] 재사용 가능한 Pagination 컴포넌트 생성
- [x] useCalendarFilters 훅에 페이지네이션 로직 추가
- [x] 필터 변경 시 자동으로 첫 페이지로 리셋
- [ ] 무한 스크롤 구현 (선택사항, 필요시 추가)

**완료된 작업**:
- ✅ `Pagination` 컴포넌트 생성 (`src/components/common/Pagination.tsx`)
- ✅ `useCalendarFilters` 훅에 페이지네이션 상태 및 로직 추가
- ✅ 페이지당 10개 항목 표시 (기본값)
- ✅ 필터 변경 시 자동으로 첫 페이지로 리셋
- ✅ 총 항목 수 및 페이지 정보 표시
- ✅ 이전/다음, 첫 페이지/마지막 페이지 버튼
- ✅ 페이지 번호 표시 (최대 5개)

**예상 시간**: 1-2일 (완료)

---

## 📊 우선순위별 요약

### 즉시 수행 권장 (High)
1. ✅ **대용량 리스트 가상화** (완료)
2. ✅ **데이터베이스 마이그레이션 실행 확인** (완료, 2025-12-11)
3. **인증/인가 강화** (3-5일) - 미완료

### 중기 목표 (Medium)
4. ✅ **타입 가드 추가** (완료)
5. ✅ **입력 검증 강화** (완료)
6. **접근성 개선** (2-3일) - 부분 완료
7. **E2E 테스트 확장** (3-5일) - 미완료
8. ✅ **스킵된 테스트 처리** (완료, 2025-12-11)

### 장기 목표 (Low)
9. **반응형 디자인 개선** (3-5일)
10. **문서화 보완** (2-3일)
11. **에러 정보 노출 제한** (1-2일)
12. **Certificate 기능 구현** (3-5일)
13. **DB 인덱스 최적화** (1-2일, 선택사항)
14. **페이지네이션/무한 스크롤** (1-2일, 선택사항)

---

## 🎯 다음 단계 권장 순서

### 1단계: 즉시 수행 (30분-1시간)
1. ✅ 대용량 리스트 가상화 구현 (완료)
2. ✅ 데이터베이스 마이그레이션 실행 확인 (완료, 2025-12-11)

### 2단계: 보안 강화 (3-5일)
3. 인증/인가 강화 (3-5일) - **프로덕션 전 필수**
4. ✅ 입력 검증 강화 (완료)

### 3단계: 품질 향상 (5-9일)
5. ✅ 타입 가드 추가 (완료)
6. 접근성 개선 (2-3일) - 부분 완료
7. E2E 테스트 확장 (3-5일) - 선택사항
8. ✅ 스킵된 테스트 처리 (완료, 2025-12-11)

### 4단계: 사용자 경험 개선 (4-7일)
9. 반응형 디자인 개선 (3-5일)
10. 에러 정보 노출 제한 (1-2일)

### 5단계: 문서화 및 기타 (5-8일)
11. 문서화 보완 (2-3일)
12. Certificate 기능 구현 (3-5일)
13. DB 인덱스 최적화 (1-2일, 선택사항)
14. 페이지네이션/무한 스크롤 (1-2일, 선택사항)

---

## 📈 예상 총 소요 시간

- **High 우선순위**: 4-7일
- **Medium 우선순위**: 11-18일
- **Low 우선순위**: 9-15일

**총 예상 시간**: 약 24-40일 (약 1-2개월)

---

## ✅ 완료 기준

각 작업은 다음 기준으로 완료로 간주됩니다:
- ✅ 코드 구현 완료
- ✅ 테스트 작성 및 통과
- ✅ 문서화 업데이트
- ✅ 코드 리뷰 완료 (필요시)
- ✅ 린터/타입 체크 통과

---

## 📝 참고 문서

- [기능 계획](./feature-plan.md) - 기능별 구현 상태
- [프로젝트 분석](./PROJECT_CRITIQUE.md) - 상세한 개선 제안
- [마이그레이션 가이드](./migrations/README.md) - 데이터베이스 마이그레이션 가이드

---

**마지막 업데이트**: 2025-01-XX
